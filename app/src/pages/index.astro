---
import Layout from "../layouts/Layout.astro";
import { loadFeedData, getAllArticles } from "../lib/data";
import ArticleList from "../components/ArticleList.svelte";
import SectionNav from "../components/SectionNav.svelte";
import ThemeToggle from "../components/ThemeToggle.svelte";
import FilterPanel from "../components/FilterPanel.svelte";

const data = loadFeedData();
const allArticles = getAllArticles(data);
---

<Layout title="Home">
  <!-- Header section with summary -->
  <div class="mb-8">
    <div class="flex flex-col lg:flex-row justify-between items-start gap-4 mb-6">
      <div>
        <h1 class="text-3xl font-bold mb-2">Today's News Digest</h1>
        <p class="text-base-content/70">
          {allArticles.length} articles from {data.sections.length} sections
        </p>
      </div>
      <div class="flex items-center gap-4">
        <ThemeToggle client:load />
      </div>
    </div>

    <!-- Overall AI Summary -->
    {
      data.overall_summary && (
        <div class="card bg-primary/10 border border-primary/20 mb-6">
          <div class="card-body">
            <h2 class="card-title text-primary">
              <span class="text-2xl">âœ¨</span> AI Summary
            </h2>
            <p class="prose prose-sm max-w-none">{data.overall_summary}</p>
          </div>
        </div>
      )
    }
  </div>

  <!-- Main content grid -->
  <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
    <!-- Sidebar -->
    <aside class="lg:col-span-1">
      <div class="sticky top-20 space-y-4">
        <!-- Section navigation -->
        <SectionNav sections={data.sections} client:load />

        <!-- Filters -->
        <FilterPanel sections={data.sections} client:load />
      </div>
    </aside>

    <!-- Articles list -->
    <div class="lg:col-span-3">
      <ArticleList
        articles={allArticles}
        sections={data.sections}
        client:load
      />
    </div>
  </div>
</Layout>
